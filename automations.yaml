# === BLOCK: AUTOMATION_LICHT_SONNENUNTERGANG ===
# Zweck: Alle Lichter (Wohnzimmer + Au√üen) bei Sonnenuntergang einschalten
# Status: ‚úÖ Getestet
# Erstellt: 2025-08-22
# Abh√§ngigkeiten: sun.sun, switch.steckdose_1-5, switch.licht_haustur_licht_haustur

- id: licht_sonnenuntergang
  alias: "Licht - Sonnenuntergang alle an"
  description: "Schaltet alle Lichter bei Sonnenuntergang mit 0.5s Verz√∂gerung ein"
  trigger:
    - trigger: sun
      event: sunset
  action:
    - action: switch.turn_on
      entity_id: switch.steckdose_1
    - delay: 0.5
    - action: switch.turn_on
      entity_id: switch.steckdose_2
    - delay: 0.5
    - action: switch.turn_on
      entity_id: switch.steckdose_3
    - delay: 0.5
    - action: switch.turn_on
      entity_id: switch.steckdose_4
    - delay: 0.5
    - action: switch.turn_on
      entity_id: switch.steckdose_5
    - delay: 0.5
    - action: switch.turn_on
      entity_id: switch.licht_haustur_licht_haustur

# === END BLOCK: AUTOMATION_LICHT_SONNENUNTERGANG ===

# === BLOCK: AUTOMATION_LICHT_NACHTABSCHALTUNG ===
# Zweck: Wohnzimmerlichter um 23:00 ausschalten
# Status: ‚úÖ Getestet
# Erstellt: 2025-08-22
# Abh√§ngigkeiten: switch.steckdose_1-5

- id: licht_nachtabschaltung
  alias: "Licht - Nachtabschaltung 23:00"
  description: "Schaltet Wohnzimmerlichter um 23:00 mit 0.5s Verz√∂gerung aus"
  trigger:
    - trigger: time
      at: "23:00:00"
  action:
    - action: switch.turn_off
      entity_id: switch.steckdose_1
    - delay: 0.5
    - action: switch.turn_off
      entity_id: switch.steckdose_2
    - delay: 0.5
    - action: switch.turn_off
      entity_id: switch.steckdose_3
    - delay: 0.5
    - action: switch.turn_off
      entity_id: switch.steckdose_4
    - delay: 0.5
    - action: switch.turn_off
      entity_id: switch.steckdose_5

# === END BLOCK: AUTOMATION_LICHT_NACHTABSCHALTUNG ===

# === BLOCK: AUTOMATION_LICHT_SONNENAUFGANG ===
# Zweck: Au√üenlampe bei Sonnenaufgang ausschalten
# Status: ‚úÖ Getestet
# Erstellt: 2025-08-22
# Abh√§ngigkeiten: sun.sun, switch.licht_haustur_licht_haustur

- id: licht_sonnenaufgang
  alias: "Licht - Sonnenaufgang Au√üenlampe aus"
  description: "Schaltet Au√üenlampe bei Sonnenaufgang aus"
  trigger:
    - trigger: sun
      event: sunrise
  action:
    - action: switch.turn_off
      entity_id: switch.licht_haustur_licht_haustur

# === END BLOCK: AUTOMATION_LICHT_SONNENAUFGANG ===

# === BLOCK: AUTOMATION_LICHT_WINTER_MORGEN_AN ===
# Zweck: Wohnzimmerlichter um 07:00 an (nur im Winter wenn Sonnenaufgang nach 07:00)
# Status: ‚úÖ Getestet
# Erstellt: 2025-08-22
# Abh√§ngigkeiten: sun.sun, switch.steckdose_1-5

- id: licht_winter_morgen_an
  alias: "Licht - Winter 07:00 Wohnzimmer an"
  description: "Schaltet Wohnzimmerlichter um 07:00 ein, nur wenn Sonnenaufgang nach 07:00"
  trigger:
    - trigger: time
      at: "07:00:00"
  condition:
    - condition: template
      value_template: "{{ as_timestamp(state_attr('sun.sun', 'next_rising')) > as_timestamp(today_at('07:00')) }}"
  action:
    - action: switch.turn_on
      entity_id: switch.steckdose_1
    - delay: 0.5
    - action: switch.turn_on
      entity_id: switch.steckdose_2
    - delay: 0.5
    - action: switch.turn_on
      entity_id: switch.steckdose_3
    - delay: 0.5
    - action: switch.turn_on
      entity_id: switch.steckdose_4
    - delay: 0.5
    - action: switch.turn_on
      entity_id: switch.steckdose_5

# === END BLOCK: AUTOMATION_LICHT_WINTER_MORGEN_AN ===

# === BLOCK: AUTOMATION_LICHT_WINTER_MORGEN_AUS ===
# Zweck: Wohnzimmerlichter um 08:00 aus (nur im Winter wenn sie um 07:00 angingen)
# Status: ‚úÖ Getestet
# Erstellt: 2025-08-22
# Abh√§ngigkeiten: sun.sun, switch.steckdose_1-5

- id: licht_winter_morgen_aus
  alias: "Licht - Winter 08:00 Wohnzimmer aus"
  description: "Schaltet Wohnzimmerlichter um 08:00 aus, nur wenn Sonnenaufgang nach 07:00"
  trigger:
    - trigger: time
      at: "08:00:00"
  condition:
    - condition: template
      value_template: "{{ as_timestamp(state_attr('sun.sun', 'next_rising')) > as_timestamp(today_at('07:00')) }}"
  action:
    - action: switch.turn_off
      entity_id: switch.steckdose_1
    - delay: 0.5
    - action: switch.turn_off
      entity_id: switch.steckdose_2
    - delay: 0.5
    - action: switch.turn_off
      entity_id: switch.steckdose_3
    - delay: 0.5
    - action: switch.turn_off
      entity_id: switch.steckdose_4
    - delay: 0.5
    - action: switch.turn_off
      entity_id: switch.steckdose_5

# === END BLOCK: AUTOMATION_LICHT_WINTER_MORGEN_AUS ===

# === BLOCK: AUTOMATION_KRITISCHE_INFRASTRUKTUR ===
# Zweck: H√§lt lebensnotwendige Ger√§te immer eingeschaltet (Stromausfall-Schutz)
# Status: üîÑ Neu
# Erstellt: 2025-08-22
# Trigger: Alle 5min + HA-Start (Stromausfall-Recovery)
# Abh√§ngigkeiten: 12 kritische Switches (K√ºhlschr√§nke, Heizung, Technik)
# Wichtig: Verhindert Lebensmittelverderb und kalte Wohnung im Winter

- id: kritische_infrastruktur_immer_an
  alias: "Kritische Infrastruktur - Immer An"
  description: "Stellt sicher, dass kritische Ger√§te nach Stromausfall wieder eingeschaltet werden"
  trigger:
    # Jede Minute pr√ºfen
    - trigger: time_pattern
      minutes: "/1"
    # Nach Home Assistant Start (Stromausfall-Recovery)
    - trigger: homeassistant
      event: start
  action:
    # Alle kritischen Switches einschalten (idempotent)
    - action: switch.turn_on
      target:
        entity_id:
          # K√ºhlger√§te - KRITISCH f√ºr Lebensmittel
          - switch.kuhlschrank
          - switch.kuhlschrank_keller
          - switch.froster_kuche
          # Wasser/Heizung - KRITISCH f√ºr Wohnen
          - switch.steckdose_31_heizung
          - switch.steckdose_23_wasserenthaerter
          - switch.steckdose_26_franke_heisswasser
          - switch.steckdose_27_franke_chiller
          # Haushaltsger√§te - WICHTIG f√ºr Alltag
          - switch.steckdose_21_waschmaschine
          - switch.steckdose_22_trockner
          - switch.steckdose_30_spuelmaschine
          # Technik-Infrastruktur - KRITISCH f√ºr System
          - switch.steckdose_34_tp_link_switch
          - switch.espsomfy

# === END BLOCK: AUTOMATION_KRITISCHE_INFRASTRUKTUR ===