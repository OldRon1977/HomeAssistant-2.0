# === BLOCK: SCRIPT_WOHNZIMMER_MASTER_BUTTON ===
# Zweck: Master-Button fÃ¼r Wohnzimmerlichter mit intelligenter Schaltlogik
# Status: âœ… Getestet - DELAYS ERFORDERLICH!
# Erstellt: 2025-08-22
# GeÃ¤ndert: 2025-08-23 - HA 2024.10+ Syntax beachtet
# AbhÃ¤ngigkeiten: switch.steckdose_1-5
# Logik: Alle ausâ†’alle an, alle anâ†’alle aus, gemischtâ†’alle aus
# WICHTIG: 0.5s Delay zwischen Schaltungen wegen Stromspitzen!

wohnzimmer_lichter_master:
  alias: "Wohnzimmer Lichter Master"
  description: "Schaltet alle Wohnzimmerlichter intelligent mit 0.5s VerzÃ¶gerung"
  sequence:
    - choose:
        # CASE 1: Alle Lichter sind AUS â†’ Alle einschalten
        - conditions:
            - condition: template
              value_template: >
                {{ is_state('switch.steckdose_1', 'off') and
                   is_state('switch.steckdose_2', 'off') and
                   is_state('switch.steckdose_3', 'off') and
                   is_state('switch.steckdose_4', 'off') and
                   is_state('switch.steckdose_5', 'off') }}
          sequence:
            - action: switch.turn_on
              target:
                entity_id: switch.steckdose_1
            - delay: 
                milliseconds: 500
            - action: switch.turn_on
              target:
                entity_id: switch.steckdose_2
            - delay: 
                milliseconds: 500
            - action: switch.turn_on
              target:
                entity_id: switch.steckdose_3
            - delay: 
                milliseconds: 500
            - action: switch.turn_on
              target:
                entity_id: switch.steckdose_4
            - delay: 
                milliseconds: 500
            - action: switch.turn_on
              target:
                entity_id: switch.steckdose_5
        
        # CASE 2: Alle Lichter sind AN â†’ Alle ausschalten
        - conditions:
            - condition: template
              value_template: >
                {{ is_state('switch.steckdose_1', 'on') and
                   is_state('switch.steckdose_2', 'on') and
                   is_state('switch.steckdose_3', 'on') and
                   is_state('switch.steckdose_4', 'on') and
                   is_state('switch.steckdose_5', 'on') }}
          sequence:
            - action: switch.turn_off
              target:
                entity_id: switch.steckdose_1
            - delay: 
                milliseconds: 500
            - action: switch.turn_off
              target:
                entity_id: switch.steckdose_2
            - delay: 
                milliseconds: 500
            - action: switch.turn_off
              target:
                entity_id: switch.steckdose_3
            - delay: 
                milliseconds: 500
            - action: switch.turn_off
              target:
                entity_id: switch.steckdose_4
            - delay: 
                milliseconds: 500
            - action: switch.turn_off
              target:
                entity_id: switch.steckdose_5

      # DEFAULT CASE: Gemischte ZustÃ¤nde â†’ Alle ausschalten
      default:
        - action: switch.turn_off
          target:
            entity_id: switch.steckdose_1
        - delay: 
            milliseconds: 500
        - action: switch.turn_off
          target:
            entity_id: switch.steckdose_2
        - delay: 
            milliseconds: 500
        - action: switch.turn_off
          target:
            entity_id: switch.steckdose_3
        - delay: 
            milliseconds: 500
        - action: switch.turn_off
          target:
            entity_id: switch.steckdose_4
        - delay: 
            milliseconds: 500
        - action: switch.turn_off
          target:
            entity_id: switch.steckdose_5

# === END BLOCK: SCRIPT_WOHNZIMMER_MASTER_BUTTON ===

# === BLOCK: SCRIPT_KLIMA_ALLE_AUS ===
# Zweck: Alle Klimaanlagen komplett ausschalten 
# Status: ðŸ”„ Neu
# Erstellt: 2025-08-22
# AbhÃ¤ngigkeiten: Alle climate EntitÃ¤ten

klima_alle_aus:
  alias: "Klima Alle AUS"
  description: "Schaltet alle Klimaanlagen aus"
  sequence:
    # Klimaanlagen ausschalten
    - action: climate.turn_off
      target:
        entity_id:
          - climate.buero
          - climate.wohnzimmer
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob

# === END BLOCK: SCRIPT_KLIMA_ALLE_AUS ===

# === BLOCK: SCRIPT_KLIMA_NACHTMODUS ===
# Zweck: SchlafrÃ¤ume auf 22Â°C + niedrigste GeblÃ¤se-Stufe + Oszillation aus + einschalten
# Status: ðŸ”„ Neu
# Erstellt: 2025-08-22
# AbhÃ¤ngigkeiten: climate.schlafzimmer, climate.finn, climate.nele, climate.jacob

klima_nachtmodus:
  alias: "Klima Nachtmodus"
  description: "Setzt SchlafrÃ¤ume auf 22Â°C, leise, Oszillation aus, einschalten"
  sequence:
    # SCHRITT 1: Klimaanlagen einschalten - alle SchlafrÃ¤ume
    - action: climate.turn_on
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # Kurz warten
    - delay: 2
    
    # SCHRITT 2: HVAC-Modus explizit auf heat_cool setzen
    - action: climate.set_hvac_mode
      data:
        hvac_mode: heat_cool
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # Wieder kurz warten
    - delay: 1
    
    # Temperatur auf 22Â°C setzen - alle SchlafrÃ¤ume
    - action: climate.set_temperature
      data:
        temperature: 22
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # TYP 1: GeblÃ¤se auf quiet (Jacob, Nele, Schlafzimmer)
    - action: climate.set_fan_mode
      data:
        fan_mode: quiet
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.nele
          - climate.jacob
    
    # TYP 2: GeblÃ¤se auf low (Finn) + Sleep Preset
    - action: climate.set_fan_mode
      data:
        fan_mode: low
      target:
        entity_id:
          - climate.finn
    
    - action: climate.set_preset_mode
      data:
        preset_mode: sleep
      target:
        entity_id:
          - climate.finn
    
    # TYP 1: Oszillation stopped (Jacob, Nele, Schlafzimmer)
    - action: climate.set_swing_mode
      data:
        swing_mode: stopped
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.nele
          - climate.jacob
    
    # TYP 2: Oszillation off (Finn)
    - action: climate.set_swing_mode
      data:
        swing_mode: 'off'
      target:
        entity_id:
          - climate.finn
    
    # TYP 1: Horizontal auch stoppen (Jacob, Nele, Schlafzimmer)
    - action: climate.set_swing_horizontal_mode
      data:
        swing_horizontal_mode: stopped
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.nele
          - climate.jacob

# === END BLOCK: SCRIPT_KLIMA_NACHTMODUS ===

# === BLOCK: SCRIPT_KLIMA_KOMFORT_MODUS ===
# Zweck: Alle Klimaanlagen auf 23Â°C + GeblÃ¤se auf auto + einschalten
# Status: ðŸ”„ Neu
# Erstellt: 2025-08-22
# AbhÃ¤ngigkeiten: Alle climate EntitÃ¤ten

klima_komfort_modus:
  alias: "Klima Komfort-Modus"
  description: "Setzt alle Klimaanlagen auf 23Â°C, GeblÃ¤se auto, einschalten"
  sequence:
    # SCHRITT 1: Klimaanlagen einschalten - alle
    - action: climate.turn_on
      target:
        entity_id:
          - climate.buero
          - climate.wohnzimmer
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # Kurz warten
    - delay: 2
    
    # SCHRITT 2: HVAC-Modus explizit auf heat_cool setzen
    - action: climate.set_hvac_mode
      data:
        hvac_mode: heat_cool
      target:
        entity_id:
          - climate.buero
          - climate.wohnzimmer
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # Wieder kurz warten
    - delay: 1
    
    # Temperatur auf 23Â°C setzen - alle Klimaanlagen
    - action: climate.set_temperature
      data:
        temperature: 23
      target:
        entity_id:
          - climate.buero
          - climate.wohnzimmer
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # GeblÃ¤se auf auto - alle Klimaanlagen (beide Typen unterstÃ¼tzen auto)
    - action: climate.set_fan_mode
      data:
        fan_mode: auto
      target:
        entity_id:
          - climate.buero
          - climate.wohnzimmer
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # TYP 2: Preset auf none zurÃ¼cksetzen (Finn, BÃ¼ro)
    - action: climate.set_preset_mode
      data:
        preset_mode: none
      target:
        entity_id:
          - climate.finn
          - climate.buero

# === END BLOCK: SCRIPT_KLIMA_KOMFORT_MODUS ===

# === BLOCK: SCRIPT_KLIMA_SCHLAFBOOSTER ===
# Zweck: Phase 1 des Schlafboosters - schnell auf 21Â°C kÃ¼hlen + einschalten
# Status: ðŸ”„ Neu
# Erstellt: 2025-08-22
# AbhÃ¤ngigkeiten: climate.schlafzimmer, climate.finn, climate.nele, climate.jacob

klima_schlafbooster:
  alias: "Klima Schlafbooster"
  description: "Phase 1: 21Â°C + high GeblÃ¤se + Oszillation an + einschalten"
  sequence:
    # Schlafbooster-Modus in Input Boolean aktivieren (fÃ¼r Automation)
    - action: input_boolean.turn_on
      target:
        entity_id: input_boolean.schlafbooster_aktiv
    
    # SCHRITT 1: Klimaanlagen einschalten - alle SchlafrÃ¤ume
    - action: climate.turn_on
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # Kurz warten
    - delay: 2
    
    # SCHRITT 2: HVAC-Modus explizit auf heat_cool setzen
    - action: climate.set_hvac_mode
      data:
        hvac_mode: heat_cool
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # Wieder kurz warten
    - delay: 1
    
    # Temperatur auf 21Â°C setzen - alle SchlafrÃ¤ume
    - action: climate.set_temperature
      data:
        temperature: 21
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # GeblÃ¤se auf high - alle SchlafrÃ¤ume (beide Typen unterstÃ¼tzen high)
    - action: climate.set_fan_mode
      data:
        fan_mode: high
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.finn
          - climate.nele
          - climate.jacob
    
    # TYP 2: Preset auf none (kein sleep beim Booster) - Finn
    - action: climate.set_preset_mode
      data:
        preset_mode: none
      target:
        entity_id:
          - climate.finn
    
    # TYP 1: Oszillation rangefull (Jacob, Nele, Schlafzimmer)
    - action: climate.set_swing_mode
      data:
        swing_mode: rangefull
      target:
        entity_id:
          - climate.schlafzimmer
          - climate.nele
          - climate.jacob
    
    # TYP 2: Oszillation on (Finn)
    - action: climate.set_swing_mode
      data:
        swing_mode: 'on'
      target:
        entity_id:
          - climate.finn

# === END BLOCK: SCRIPT_KLIMA_SCHLAFBOOSTER ===

# === BLOCK: SCRIPT_KLIMA_SCHLAFBOOSTER_PHASE2 ===
# Zweck: Phase 2 des Schlafboosters - automatisch in Schlafmodus wechseln
# Status: ðŸ”„ Neu
# Erstellt: 2025-08-22
# AbhÃ¤ngigkeiten: Wird von Automation aufgerufen

klima_schlafbooster_phase2:
  alias: "Klima Schlafbooster Phase 2"
  description: "Phase 2: Automatisch auf 22Â°C + leise + nach oben"
  sequence:
    # Schlafbooster-Modus deaktivieren
    - action: input_boolean.turn_off
      target:
        entity_id: input_boolean.schlafbooster_aktiv
    
    # In normalen Nachtmodus wechseln
    - action: script.turn_on
      target:
        entity_id: script.klima_nachtmodus

# === END BLOCK: SCRIPT_KLIMA_SCHLAFBOOSTER_PHASE2 ===

# === BLOCK: SCRIPT_DACHLUKE_DUSCHMODUS ===
# Zweck: Duschmodus - Dachluke auf 70% Ã¶ffnen und Timer starten
# Status: ðŸ”„ Neu
# Erstellt: 2025-08-23
# AbhÃ¤ngigkeiten: cover.strom_dachluke_unten_dachluke_bad_unten
# Logik: Immer auf 70% Ã¶ffnen â†’ Timer startet automatisch durch Automation

dachluke_duschmodus:
  alias: "Dachluke Duschmodus"
  description: "Ã–ffnet Dachluke auf 70% fÃ¼r optimale BelÃ¼ftung beim Duschen"
  sequence:
    - action: cover.set_cover_position
      entity_id: cover.strom_dachluke_unten_dachluke_bad_unten
      data:
        position: 70

# === END BLOCK: SCRIPT_DACHLUKE_DUSCHMODUS ===

# ============================================================================
# BEWÃ„SSERUNGS-SCRIPTS - SMART IRRIGATION INTEGRATION
# Status: âœ… ERWEITERT - Smart Irrigation Support
# GeÃ¤ndert: 2025-08-26 - Auto-Modus mit Smart Irrigation
# ============================================================================

# === BLOCK: BEWAESSERUNG_AUTO ===
# Zweck: BewÃ¤sserung mit Smart Irrigation Werten
# Status: âœ… KORRIGIERT - Vereinfacht ohne komplexe Variablen
# Erstellt: 2025-08-26
# GeÃ¤ndert: 2025-08-26 - Bucket-Reset direkt nach BewÃ¤sserung
# AbhÃ¤ngigkeiten: sensor.smart_irrigation_zone_*, smart_irrigation.reset_bucket
# WICHTIG: Smart Irrigation liefert Werte in SEKUNDEN!

bewaesserung_auto:
  alias: "BewÃ¤sserung Auto (Smart Irrigation)"
  description: "Startet BewÃ¤sserung mit Zeiten von Smart Irrigation"
  mode: single
  sequence:
    # System-Check
    - condition: state
      entity_id: binary_sensor.bewcmp_system_bereit
      state: 'on'
    
    # Hauptschalter einschalten
    - action: switch.turn_on
      target:
        entity_id: switch.bewcmp_bewasserung_hauptschalter
    
    # Zone 1 mit Smart Irrigation Zeit (Sekunden zu Minuten)
    - if:
        - condition: state
          entity_id: switch.bewcmp_zone_1_aktiviert
          state: 'on'
        - condition: template
          value_template: >
            {{ states('sensor.smart_irrigation_zone_1') | float(0) > 0 }}
      then:
        - action: switch.turn_on
          target:
            entity_id: switch.bewcmp_zone_1
        - delay:
            minutes: "{{ (states('sensor.smart_irrigation_zone_1') | float(0) / 60) | round(1) }}"
        - action: switch.turn_off
          target:
            entity_id: switch.bewcmp_zone_1
        # Bucket sofort zurÃ¼cksetzen nach BewÃ¤sserung
        - action: smart_irrigation.reset_bucket
          data:
            entity_id: sensor.smart_irrigation_zone_1
    
    # Zone 2 mit Smart Irrigation Zeit (Sekunden zu Minuten)
    - if:
        - condition: state
          entity_id: switch.bewcmp_zone_2_aktiviert
          state: 'on'
        - condition: template
          value_template: >
            {{ states('sensor.smart_irrigation_zone_2') | float(0) > 0 }}
      then:
        - action: switch.turn_on
          target:
            entity_id: switch.bewcmp_zone_2
        - delay:
            minutes: "{{ (states('sensor.smart_irrigation_zone_2') | float(0) / 60) | round(1) }}"
        - action: switch.turn_off
          target:
            entity_id: switch.bewcmp_zone_2
        # Bucket sofort zurÃ¼cksetzen nach BewÃ¤sserung
        - action: smart_irrigation.reset_bucket
          data:
            entity_id: sensor.smart_irrigation_zone_2
    
    # Hauptschalter ausschalten
    - action: switch.turn_off
      target:
        entity_id: switch.bewcmp_bewasserung_hauptschalter
    
    # Benachrichtigung wenn fertig
    - action: persistent_notification.create
      data:
        title: "BewÃ¤sserung abgeschlossen"
        message: >
          Smart Irrigation BewÃ¤sserung beendet.
          Zone 1: {{ (states('sensor.smart_irrigation_zone_1') | float(0) / 60) | round(1) }} Min
          Zone 2: {{ (states('sensor.smart_irrigation_zone_2') | float(0) / 60) | round(1) }} Min
        notification_id: bewaesserung_auto_fertig

# === END BLOCK: BEWAESSERUNG_AUTO ===

# === BLOCK: BEWAESSERUNG_STANDARD ===
# Zweck: BewÃ¤sserung mit Standard-Zeiten
# Status: ðŸ”„ Neu - EigenstÃ¤ndige Implementation
# Erstellt: 2025-08-26
# AbhÃ¤ngigkeiten: switch.bewcmp_zone_*, number.bewcmp_zone_*_dauer

bewaesserung_standard:
  alias: "BewÃ¤sserung Standard"
  description: "Startet BewÃ¤sserung mit eingestellten Standard-Zeiten"
  mode: single
  sequence:
    # System-Check
    - condition: state
      entity_id: binary_sensor.bewcmp_system_bereit
      state: 'on'
    
    # Hauptschalter einschalten
    - action: switch.turn_on
      target:
        entity_id: switch.bewcmp_bewasserung_hauptschalter
    
    # Auto-Sequenz aktivieren
    - action: switch.turn_on
      target:
        entity_id: switch.bewcmp_auto_sequenz
    
    # Zone 1 wenn aktiviert
    - if:
        - condition: state
          entity_id: switch.bewcmp_zone_1_aktiviert
          state: 'on'
      then:
        - action: switch.turn_on
          target:
            entity_id: switch.bewcmp_zone_1
        - delay:
            minutes: "{{ states('number.bewcmp_zone_1_dauer') | int }}"
        - action: switch.turn_off
          target:
            entity_id: switch.bewcmp_zone_1
    
    # Zone 2 wenn aktiviert
    - if:
        - condition: state
          entity_id: switch.bewcmp_zone_2_aktiviert
          state: 'on'
      then:
        - action: switch.turn_on
          target:
            entity_id: switch.bewcmp_zone_2
        - delay:
            minutes: "{{ states('number.bewcmp_zone_2_dauer') | int }}"
        - action: switch.turn_off
          target:
            entity_id: switch.bewcmp_zone_2
    
    # Hauptschalter ausschalten
    - action: switch.turn_off
      target:
        entity_id: switch.bewcmp_bewasserung_hauptschalter

# === END BLOCK: BEWAESSERUNG_STANDARD ===

# === BLOCK: BEWAESSERUNG_VOLLPROGRAMM ===
# Zweck: Startet kompletten BewÃ¤sserungszyklus (identisch mit bewaesserung_standard)
# Status: âœ… Korrigiert - Direkte Switch-Steuerung
# AbhÃ¤ngigkeiten: switch.bewcmp_zone_1, switch.bewcmp_zone_2

bewaesserung_vollprogramm:
  alias: "BewÃ¤sserung Vollprogramm"
  description: "Startet kompletten Zyklus mit allen aktivierten Zonen"
  mode: single
  sequence:
    # Ruft bewaesserung_standard auf (identische Funktion)
    - action: script.bewaesserung_standard

# === END BLOCK: BEWAESSERUNG_VOLLPROGRAMM ===

# === BLOCK: BEWAESSERUNG_ZONE_1 ===
# Zweck: Startet nur Zone 1
# Status: âœ… Korrigiert - Direkte Switch-Steuerung

bewaesserung_zone_1:
  alias: "BewÃ¤sserung Zone 1"
  description: "Startet nur Zone 1 fÃ¼r angegebene Minuten"
  mode: restart
  fields:
    minuten:
      description: "Laufzeit in Minuten (Standard: eingestellte Zeit)"
      example: "15"
      default: 0
  sequence:
    # System-Check
    - condition: state
      entity_id: binary_sensor.bewcmp_system_bereit
      state: 'on'
    
    # Zone muss aktiviert sein
    - condition: state
      entity_id: switch.bewcmp_zone_1_aktiviert
      state: 'on'
    
    # Hauptschalter einschalten
    - action: switch.turn_on
      target:
        entity_id: switch.bewcmp_bewasserung_hauptschalter
    
    # Zone 1 einschalten
    - action: switch.turn_on
      target:
        entity_id: switch.bewcmp_zone_1
    
    # Warten
    - delay:
        minutes: >
          {% if minuten | int > 0 %}
            {{ minuten | int }}
          {% else %}
            {{ states('number.bewcmp_zone_1_dauer') | int }}
          {% endif %}
    
    # Zone 1 ausschalten
    - action: switch.turn_off
      target:
        entity_id: switch.bewcmp_zone_1
    
    # Hauptschalter ausschalten wenn keine andere Zone lÃ¤uft
    - if:
        - condition: state
          entity_id: binary_sensor.bewcmp_zone_2_aktiv
          state: 'off'
      then:
        - action: switch.turn_off
          target:
            entity_id: switch.bewcmp_bewasserung_hauptschalter

# === END BLOCK: BEWAESSERUNG_ZONE_1 ===

# === BLOCK: BEWAESSERUNG_ZONE_2 ===
# Zweck: Startet nur Zone 2
# Status: âœ… Korrigiert - Direkte Switch-Steuerung

bewaesserung_zone_2:
  alias: "BewÃ¤sserung Zone 2"
  description: "Startet nur Zone 2 fÃ¼r angegebene Minuten"
  mode: restart
  fields:
    minuten:
      description: "Laufzeit in Minuten (Standard: eingestellte Zeit)"
      example: "15"
      default: 0
  sequence:
    # System-Check
    - condition: state
      entity_id: binary_sensor.bewcmp_system_bereit
      state: 'on'
    
    # Zone muss aktiviert sein
    - condition: state
      entity_id: switch.bewcmp_zone_2_aktiviert
      state: 'on'
    
    # Hauptschalter einschalten
    - action: switch.turn_on
      target:
        entity_id: switch.bewcmp_bewasserung_hauptschalter
    
    # Zone 2 einschalten
    - action: switch.turn_on
      target:
        entity_id: switch.bewcmp_zone_2
    
    # Warten
    - delay:
        minutes: >
          {% if minuten | int > 0 %}
            {{ minuten | int }}
          {% else %}
            {{ states('number.bewcmp_zone_2_dauer') | int }}
          {% endif %}
    
    # Zone 2 ausschalten
    - action: switch.turn_off
      target:
        entity_id: switch.bewcmp_zone_2
    
    # Hauptschalter ausschalten wenn keine andere Zone lÃ¤uft
    - if:
        - condition: state
          entity_id: binary_sensor.bewcmp_zone_1_aktiv
          state: 'off'
      then:
        - action: switch.turn_off
          target:
            entity_id: switch.bewcmp_bewasserung_hauptschalter

# === END BLOCK: BEWAESSERUNG_ZONE_2 ===

# === BLOCK: BEWAESSERUNG_ZONE_1_15MIN ===
# Zweck: SchnellbewÃ¤sserung Zone 1 fÃ¼r 15 Minuten
# Status: âœ… Korrigiert

bewaesserung_zone_1_15min:
  alias: "Zone 1 - 15 Minuten"
  description: "BewÃ¤ssert Zone 1 fÃ¼r 15 Minuten"
  sequence:
    - action: script.bewaesserung_zone_1
      data:
        minuten: 15

# === END BLOCK: BEWAESSERUNG_ZONE_1_15MIN ===

# === BLOCK: BEWAESSERUNG_ZONE_1_30MIN ===
# Zweck: SchnellbewÃ¤sserung Zone 1 fÃ¼r 30 Minuten
# Status: âœ… Korrigiert

bewaesserung_zone_1_30min:
  alias: "Zone 1 - 30 Minuten"
  description: "BewÃ¤ssert Zone 1 fÃ¼r 30 Minuten"
  sequence:
    - action: script.bewaesserung_zone_1
      data:
        minuten: 30

# === END BLOCK: BEWAESSERUNG_ZONE_1_30MIN ===

# === BLOCK: BEWAESSERUNG_ZONE_1_60MIN ===
# Zweck: SchnellbewÃ¤sserung Zone 1 fÃ¼r 60 Minuten
# Status: âœ… Korrigiert

bewaesserung_zone_1_60min:
  alias: "Zone 1 - 60 Minuten"
  description: "BewÃ¤ssert Zone 1 fÃ¼r 60 Minuten"
  sequence:
    - action: script.bewaesserung_zone_1
      data:
        minuten: 60

# === END BLOCK: BEWAESSERUNG_ZONE_1_60MIN ===

# === BLOCK: BEWAESSERUNG_ZONE_2_15MIN ===
# Zweck: SchnellbewÃ¤sserung Zone 2 fÃ¼r 15 Minuten
# Status: âœ… Korrigiert

bewaesserung_zone_2_15min:
  alias: "Zone 2 - 15 Minuten"
  description: "BewÃ¤ssert Zone 2 fÃ¼r 15 Minuten"
  sequence:
    - action: script.bewaesserung_zone_2
      data:
        minuten: 15

# === END BLOCK: BEWAESSERUNG_ZONE_2_15MIN ===

# === BLOCK: BEWAESSERUNG_ZONE_2_30MIN ===
# Zweck: SchnellbewÃ¤sserung Zone 2 fÃ¼r 30 Minuten
# Status: âœ… Korrigiert

bewaesserung_zone_2_30min:
  alias: "Zone 2 - 30 Minuten"
  description: "BewÃ¤ssert Zone 2 fÃ¼r 30 Minuten"
  sequence:
    - action: script.bewaesserung_zone_2
      data:
        minuten: 30

# === END BLOCK: BEWAESSERUNG_ZONE_2_30MIN ===

# === BLOCK: BEWAESSERUNG_ZONE_2_60MIN ===
# Zweck: SchnellbewÃ¤sserung Zone 2 fÃ¼r 60 Minuten
# Status: âœ… Korrigiert

bewaesserung_zone_2_60min:
  alias: "Zone 2 - 60 Minuten"
  description: "BewÃ¤ssert Zone 2 fÃ¼r 60 Minuten"
  sequence:
    - action: script.bewaesserung_zone_2
      data:
        minuten: 60

# === END BLOCK: BEWAESSERUNG_ZONE_2_60MIN ===

# === BLOCK: BEWAESSERUNG_PAUSE ===
# Zweck: Pausiert laufende BewÃ¤sserung
# Status: âœ… Korrigiert - Nutzt Standby Switch

bewaesserung_pause:
  alias: "BewÃ¤sserung Pausieren"
  description: "Pausiert die laufende BewÃ¤sserung"
  sequence:
    - action: switch.turn_on
      target:
        entity_id: switch.bewcmp_standby_modus

# === END BLOCK: BEWAESSERUNG_PAUSE ===

# === BLOCK: BEWAESSERUNG_RESUME ===
# Zweck: Setzt pausierte BewÃ¤sserung fort
# Status: âœ… Korrigiert - Deaktiviert Standby

bewaesserung_resume:
  alias: "BewÃ¤sserung Fortsetzen"
  description: "Setzt die pausierte BewÃ¤sserung fort"
  sequence:
    - action: switch.turn_off
      target:
        entity_id: switch.bewcmp_standby_modus

# === END BLOCK: BEWAESSERUNG_RESUME ===

# === BLOCK: BEWAESSERUNG_STOP ===
# Zweck: Stoppt BewÃ¤sserung komplett
# Status: âœ… Korrigiert - NOTFALL STOP Button + Switches

bewaesserung_stop:
  alias: "BewÃ¤sserung Stoppen"
  description: "Stoppt die BewÃ¤sserung komplett"
  sequence:
    # NOTFALL STOP Button drÃ¼cken
    - action: button.press
      target:
        entity_id: button.bewcmp_notfall_stop
    
    # Sicherheitshalber auch alle Switches aus
    - action: switch.turn_off
      target:
        entity_id:
          - switch.bewcmp_zone_1
          - switch.bewcmp_zone_2
          - switch.bewcmp_bewasserung_hauptschalter
          - switch.bewcmp_auto_sequenz

# === END BLOCK: BEWAESSERUNG_STOP ===

# === BLOCK: BEWAESSERUNG_NAECHSTE_ZONE ===
# Zweck: Springt zur nÃ¤chsten Zone
# Status: âœ… Korrigiert - Manuelle Umschaltung

bewaesserung_naechste_zone:
  alias: "NÃ¤chste Zone"
  description: "Springt zur nÃ¤chsten Zone im Zyklus"
  sequence:
    # Wenn Zone 1 lÃ¤uft -> zu Zone 2
    - if:
        - condition: state
          entity_id: binary_sensor.bewcmp_zone_1_aktiv
          state: 'on'
      then:
        - action: switch.turn_off
          target:
            entity_id: switch.bewcmp_zone_1
        - delay: 1
        - if:
            - condition: state
              entity_id: switch.bewcmp_zone_2_aktiviert
              state: 'on'
          then:
            - action: switch.turn_on
              target:
                entity_id: switch.bewcmp_zone_2
    # Wenn Zone 2 lÃ¤uft -> beenden
    - if:
        - condition: state
          entity_id: binary_sensor.bewcmp_zone_2_aktiv
          state: 'on'
      then:
        - action: switch.turn_off
          target:
            entity_id: switch.bewcmp_zone_2

# === END BLOCK: BEWAESSERUNG_NAECHSTE_ZONE ===